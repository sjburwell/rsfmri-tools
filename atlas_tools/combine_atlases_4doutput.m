gift; close;


outatlas=  './Ray2013-ICA70.nii';
atlases = {...
 './Ray2013/thresh_zstatd70_01.nii.gz',...
 './Ray2013/thresh_zstatd70_02.nii.gz',...
 './Ray2013/thresh_zstatd70_03.nii.gz',...
 './Ray2013/thresh_zstatd70_04.nii.gz',...
 './Ray2013/thresh_zstatd70_05.nii.gz',...
 './Ray2013/thresh_zstatd70_06.nii.gz',...
 './Ray2013/thresh_zstatd70_07.nii.gz',...
 './Ray2013/thresh_zstatd70_08.nii.gz',...
 './Ray2013/thresh_zstatd70_09.nii.gz',...
 './Ray2013/thresh_zstatd70_10.nii.gz',...
 './Ray2013/thresh_zstatd70_11.nii.gz',...
 './Ray2013/thresh_zstatd70_12.nii.gz',...
 './Ray2013/thresh_zstatd70_13.nii.gz',...
 './Ray2013/thresh_zstatd70_14.nii.gz',...
 './Ray2013/thresh_zstatd70_15.nii.gz',...
 './Ray2013/thresh_zstatd70_16.nii.gz',...
 './Ray2013/thresh_zstatd70_17.nii.gz',...
 './Ray2013/thresh_zstatd70_18.nii.gz',...
 './Ray2013/thresh_zstatd70_19.nii.gz',...
 './Ray2013/thresh_zstatd70_20.nii.gz',...
 './Ray2013/thresh_zstatd70_21.nii.gz',...
 './Ray2013/thresh_zstatd70_22.nii.gz',...
 './Ray2013/thresh_zstatd70_23.nii.gz',...
 './Ray2013/thresh_zstatd70_24.nii.gz',...
 './Ray2013/thresh_zstatd70_25.nii.gz',...
 './Ray2013/thresh_zstatd70_26.nii.gz',...
 './Ray2013/thresh_zstatd70_27.nii.gz',...
 './Ray2013/thresh_zstatd70_28.nii.gz',...
 './Ray2013/thresh_zstatd70_29.nii.gz',...
 './Ray2013/thresh_zstatd70_30.nii.gz',...
 './Ray2013/thresh_zstatd70_31.nii.gz',...
 './Ray2013/thresh_zstatd70_32.nii.gz',...
 './Ray2013/thresh_zstatd70_33.nii.gz',...
 './Ray2013/thresh_zstatd70_34.nii.gz',...
 './Ray2013/thresh_zstatd70_35.nii.gz',...
 './Ray2013/thresh_zstatd70_36.nii.gz',...
 './Ray2013/thresh_zstatd70_37.nii.gz',...
 './Ray2013/thresh_zstatd70_38.nii.gz',...
 './Ray2013/thresh_zstatd70_39.nii.gz',...
 './Ray2013/thresh_zstatd70_40.nii.gz',...
 './Ray2013/thresh_zstatd70_41.nii.gz',...
 './Ray2013/thresh_zstatd70_42.nii.gz',...
 './Ray2013/thresh_zstatd70_43.nii.gz',...
 './Ray2013/thresh_zstatd70_44.nii.gz',...
 './Ray2013/thresh_zstatd70_45.nii.gz',...
 './Ray2013/thresh_zstatd70_46.nii.gz',...
 './Ray2013/thresh_zstatd70_47.nii.gz',...
 './Ray2013/thresh_zstatd70_48.nii.gz',...
 './Ray2013/thresh_zstatd70_49.nii.gz',...
 './Ray2013/thresh_zstatd70_50.nii.gz',...
 './Ray2013/thresh_zstatd70_51.nii.gz',...
 './Ray2013/thresh_zstatd70_52.nii.gz',...
 './Ray2013/thresh_zstatd70_53.nii.gz',...
 './Ray2013/thresh_zstatd70_54.nii.gz',...
 './Ray2013/thresh_zstatd70_55.nii.gz',...
 './Ray2013/thresh_zstatd70_56.nii.gz',...
 './Ray2013/thresh_zstatd70_57.nii.gz',...
 './Ray2013/thresh_zstatd70_58.nii.gz',...
 './Ray2013/thresh_zstatd70_59.nii.gz',...
 './Ray2013/thresh_zstatd70_60.nii.gz',...
 './Ray2013/thresh_zstatd70_61.nii.gz',...
 './Ray2013/thresh_zstatd70_62.nii.gz',...
 './Ray2013/thresh_zstatd70_63.nii.gz',...
 './Ray2013/thresh_zstatd70_64.nii.gz',...
 './Ray2013/thresh_zstatd70_65.nii.gz',...
 './Ray2013/thresh_zstatd70_66.nii.gz',...
 './Ray2013/thresh_zstatd70_67.nii.gz',...
 './Ray2013/thresh_zstatd70_68.nii.gz',...
 './Ray2013/thresh_zstatd70_69.nii.gz',...
 './Ray2013/thresh_zstatd70_70.nii.gz'};

counter = 0;
for ii  = 1:length(atlases), 
  tmpV = spm_vol(atlases{ii}); tmpY = spm_read_vols(tmpV);
  if ii==1, 
     outY = double(tmpY); outV = tmpV; outV.fname = outatlas;
  else,
    if sum(abs(outV(1).dim - tmpV.dim))>0
     tmpY = squeeze(icatb_resizeData(atlases{1}, tmpV.fname));
    end
  end

  counter = counter+1;
  if ii~=1, outY = cat(4,outY,tmpY); end; %outV = cat(1,outV,outV(1)); end

end
%spm_write_vol(outV,outY);
rest_Write4DNIfTI(outY,outV,outatlas)
